{% extends 'experiments/base.html' %}

{% block header %}
    {% include 'experiments/header_home.html' %}
{% endblock %}

{% block content %}
    <section class="container">
        <div id="id_table_title" class="table-title">
            <h2>List of Experiments</h2>
        </div>
        {% if experiments %}
            {% load experiment_extras %}
            {% if user.is_authenticated and user|has_group:'trustees' %}
                {% include 'experiments/list_trustee.html' %}
            {% else %}
                {% include 'experiments/list_default.html' %}
            {% endif %}
        {% else %}
            <p>There's no experiments yet.</p>
        {% endif %}
    </section>
{% endblock %}

{% block script %}
    <script>  {# this script is related to experiment/list_trustee.html #}
    /**
     * Receives experiment status and statuses in json encoding,
     * and construct html with input radios in a form.
     */
    function statuses_radio_options(experiment, statuses) {
        var html = '<form action="/experiments/' + experiment.id + '/change_status" ' +
            'id="id_status_choices" method="POST">';
        html += "{% csrf_token %}";
        for (var i = 0; i < statuses.length; i++) {
            html += ('<input type="radio" name="status" value="' +
            statuses[i][0] + '"' +
            (experiment.status === statuses[i][0] ? 'checked' : '') + '>' +
            statuses[i][1] + '<br>');
        }
        html += '<br>';
        html += '<div class=modal-footer>';
        html += '<button type="button" class="btn btn-default" ' +
            'data-dismiss="modal">Close</button>';
        html += '<input id="id_submit" type="submit" value="Save changes" ' +
            'class="btn ' + 'btn-primary">';
        html += '</form>';
        html += '</div>';
        return html;

    }
    $('#status_modal').on('show.bs.modal', function (event) {
            var link = $(event.relatedTarget);
            var experiment = {
                id: link.data('experiment_id'),
                title: link.data('experiment_title'),
                status: link.data('experiment_status')
            };
            var statuses = link.data('experiment_statuses');
            var modal = $(this);
            modal.find('.modal-title').text('Change status for experiment ' +
                '"' + experiment.title + '"');
            var modal_body = modal.find('.modal-body');
            statuses = JSON.parse(statuses);
            var html = statuses_radio_options(experiment, statuses);
            modal_body.text('Please select an option:');
            modal_body.append(html);
        })
    </script>
{% endblock %}
