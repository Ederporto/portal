{% extends 'experiments/base.html' %}

{% block header %}
    {% include 'experiments/header_detail.html' %}
{% endblock %}

{% block content %}
    <section class="container toggable-tabs">
        <ul class="nav nav-tabs" role="tablist">
            <li role="presentation" class="active"><a href="#statistics" role="tab" data-toggle="tab">Statistics</a></li>
            <li role="presentation"><a href="#groups" role="tab" data-toggle="tab">Groups</a></li>
            <li role="presentation"><a href="#settings" role="tab" data-toggle="tab">Settings</a></li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content">

            <div role="tabpanel" class="tab-pane active" id="statistics">
                <div class="row">
                    <div class="col-md-6">
                        <div id="gender-chart" style="height: 300px;"></div>
                    </div>
                    <div class="col-md-6">
                        <div id="age-chart" style="height: 300px;"></div>
                    </div>
                </div>
            </div>

            <div role="tabpanel" class="tab-pane" id="groups">
                {% for group in experiment.groups.all %}
                    <div class="panel panel-default">
                        <div class="row">
                            <div class="col-md-2">
                                {% if group.experimental_protocol.image %}
                                    <a><img src="/media/{{ group.experimental_protocol.image }}" style="width: 100%" /></a>
                                {% endif %}
                            </div>
                            <div class="col-md-10">
                                <h5>{{ group.title }}</h5>
                                <h6>{{ group.description }}</h6>
                                {% if group.inclusion_criteria.all %}
                                    <h6>Inclusion criterias:<br/>
                                        {% for criteria in group.inclusion_criteria.all %}
                                            {{ criteria.code }} - {{ criteria.description }}{% if not forloop.last %},{% endif %}
                                        {% endfor %}
                                    </h6>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>

            <div role="tabpanel" class="tab-pane" id="settings">Settings</div>
        </div>
    </section>
{% endblock %}

{% block script %}
    {##}
    {## Script related to experiments/top.html #}
    {##}
    {% load static %}
    <script src="{% static 'js/new_experiments_received.js' %}"></script>
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <script>

        google.charts.load('current', {packages: ['corechart', 'bar']});
        google.charts.setOnLoadCallback(drawPieChart);
        google.charts.setOnLoadCallback(drawColumnChart);

        function drawPieChart() {
            var data_array = [['Gender', 'Number of participants']];
            var django_data = {{ gender_grouping|safe }};
            for (var item in django_data){
                data_array.push([item, django_data[item]])
            }
            var data = google.visualization.arrayToDataTable(data_array);
            var options = {
              title: 'Gender of the participants',
              pieHole: 0.3
            };
            var chart = new google.visualization.PieChart(document.getElementById('gender-chart'));
            chart.draw(data, options);
        }

        function drawColumnChart() {
            var data_array = [['Age', 'amount' ]];
            var django_data = {{ age_grouping|safe }};
            for (var item in django_data){
                data_array.push([item, django_data[item]])
            }
            var data = google.visualization.arrayToDataTable(data_array);
            var options = {
                title: 'Age of the participants',
                legend: { position: 'none' },
                hAxis: {
                  title: 'Age (years)'
                },
                vAxis: {
                  title: 'Amount'
                }
            };
            var chart = new google.visualization.ColumnChart(document.getElementById('age-chart'));
            chart.draw(data, options);
        }

    </script>
{% endblock %}