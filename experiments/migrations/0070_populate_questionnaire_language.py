# -*- coding: utf-8 -*-
# Generated by Django 1.11.3 on 2017-10-19 18:07
from __future__ import unicode_literals

from django.db import migrations


def backwards_data(apps, schema_editor):
    pass


def load_data(apps, schema_editor):
    questionnaire_model = apps.get_model("experiments", "Questionnaire")
    questionnaire_language_model = apps.get_model("experiments", "QuestionnaireLanguage")
    questionnaire_default_language_model = apps.get_model("experiments", "QuestionnaireDefaultLanguage")

    for questionnaire in questionnaire_model.objects.all():
        if not questionnaire_language_model.objects.filter(questionnaire=questionnaire, language_code='en').exists():
            questionnaire_language_model.objects.create(questionnaire=questionnaire,
                                                        language_code='en',
                                                        survey_name=questionnaire.survey_name,
                                                        survey_metadata=questionnaire.survey_metadata)

        if not questionnaire_default_language_model.objects.filter(questionnaire=questionnaire).exists():
            questionnaire_language = questionnaire_language_model.objects.filter(questionnaire=questionnaire).first()
            questionnaire_default_language_model.objects.create(questionnaire=questionnaire,
                                                                questionnaire_language=questionnaire_language)


class Migration(migrations.Migration):

    dependencies = [
        ('experiments', '0069_questionnaire_language'),
    ]

    operations = [
        migrations.RunPython(load_data, backwards_data)
    ]
